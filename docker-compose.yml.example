version: "3.8"

networks:
  lab_net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.50.0/24

services:
  hub:
    image: iot-hub
    container_name: hub
    networks:
      lab_net:
        ipv4_address: 192.168.50.10
    environment:
      HUB_API_PORT: 7000
      REGISTRY_DB_PATH: /data/hub_registry.db
      MODBUS_PORT: 1502
      DICOM_PORT: 11112
      RTSP_PORT: 8554
      IPP_PORT: 6310
      SNMP_PORT: 16100
    ports:
      - "7000:7000"
    volumes:
      - ./data/hub:/data

  device-camera:
    image: iot-device
    depends_on:
      - hub
    cap_add:
      - NET_ADMIN
    environment:
      DEVICE_TYPE: CAMERA_RTSP
      DEVICE_ID: cam01
      HUB_IP: 192.168.50.10
      ROLE: server
      RTSP_PORT: 8554
    networks:
      lab_net: {}

  device-printer:
    image: iot-device
    depends_on:
      - hub
    cap_add:
      - NET_ADMIN
    environment:
      DEVICE_TYPE: PRINTER_SERVICE
      DEVICE_ID: prn01
      HUB_IP: 192.168.50.10
      ROLE: both
      IPP_PORT: 6310
      SNMP_PORT: 16100
    networks:
      lab_net: {}

  device-plc:
    image: iot-device
    depends_on:
      - hub
    cap_add:
      - NET_ADMIN
    environment:
      DEVICE_TYPE: PLC_MODBUS
      DEVICE_ID: plc01
      HUB_IP: 192.168.50.10
      ROLE: both
      MODBUS_PORT: 1502
    networks:
      lab_net: {}

# Example extensions:
#  device-dicom:
#    image: iot-device
#    environment:
#      DEVICE_TYPE: XRAY_DICOM
#      DEVICE_ID: xray01
#      HUB_IP: 192.168.50.10
#      ROLE: server
#      DICOM_PORT: 11112
#    cap_add:
#      - NET_ADMIN
#    networks:
#      lab_net: {}
#
# To switch to macvlan replace the network definition with:
#  driver: macvlan
#  driver_opts:
#    parent: eth0
#  ipam:
#    config:
#      - subnet: 192.168.50.0/24
